#!/bin/bash

MODE=${1-patch}

CURRENT_VERSION=$(./bin/version/current)
NEXT_VERSION=$(./bin/version/next $MODE)

echo "Updating mix.exs from ${CURRENT_VERSION} to ${NEXT_VERSION}"
sed -i '' "s/$CURRENT_VERSION/$NEXT_VERSION/g" mix.exs

NEW_VERSION=$(./bin/version/current)

if [ "${NEW_VERSION}" != "${NEXT_VERSION}" ]; then
  echo "Unable to update version, stopping script"
  exit 1
fi

(git add mix.exs && \
 git commit -m "v${NEW_VERSION}" && \
 git tag "v${NEW_VERSION}" && \
 git push && \
 git push --tag)